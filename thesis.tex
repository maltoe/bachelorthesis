\documentclass[a4paper,10pt]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{ae}
\usepackage[a4paper]{geometry}
\usepackage{amsmath}

% package for inline figures not contained in debian
%\usepackage{floatflt}

\usepackage{fancyhdr}
\usepackage{fancyref}
\usepackage{listings}
\usepackage{booktabs}
\usepackage[perpage]{footmisc}
\usepackage{graphicx} 
\usepackage[page,titletoc]{appendix}
\usepackage{color}
\usepackage{caption}
\usepackage{hyperref}
\usepackage{breakurl}

% Header and Footer Style
\pagestyle{fancy}
\fancyhead{}
\fancyhead[R]{\slshape Malte Rohde}
\fancyhead[L]{\slshape\nouppercase{\rightmark}}
\fancyfoot{}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}} 

% No identation
\setlength\headheight{15pt}
\setlength\parindent{0pt} 

% custom commands
\newcommand\parbig{\par\bigskip}
\newcommand\parmed{\par\medskip}
\newcommand{\mailto}[1]{\href{mailto:#1}{#1}}

% List of Listings
\renewcommand*{\lstlistlistingname}{List of Listings}

% Pimp my listings environment.
% Credits go to stackoverflow:
% http://stackoverflow.com/questions/741985/latex-source-code-listing-like-in-professional-books
\lstset{
         basicstyle=\footnotesize\ttfamily, % Standardschrift
         numberstyle=\tiny,          % Stil der Zeilennummern
         numbers=left,
         stepnumber=1,
         numbersep=7pt,              % Abstand der Nummern zum Text
         tabsize=2,                  % Groesse von Tabs
         extendedchars=true,         %
         breaklines=true,            % Zeilen werden Umgebrochen       
         stringstyle=\color{white}\ttfamily, % Farbe der String
         showspaces=false,           % Leerzeichen anzeigen ?
         showtabs=false,             % Tabs anzeigen ?
         %frame=b,                   % Linie unten
         xleftmargin=17pt,
         framexleftmargin=17pt,
         framexrightmargin=5pt,
         framexbottommargin=4pt,
         showstringspaces=false      % Leerzeichen in Strings anzeigen ?      
 }

% Pimp my captions.
\DeclareCaptionFont{white}{\color{white}}
\DeclareCaptionFormat{listing}{\colorbox[cmyk]{0.43, 0.35, 0.35,0.01}{\parbox{\textwidth}{\hspace{15pt}#1#2#3}}}
\captionsetup[lstlisting]{format=listing,labelfont=white,textfont=white, singlelinecheck=false, margin=0pt, font={bf}}
%\DeclareCaptionFormat{figure}{\colorbox[cmyk]{0.43, 0.35, 0.35,0.01}{\parbox{\textwidth}{\hspace{15pt}#1#2#3}}}
%\captionsetup[figure]{format=listing,labelfont=white,textfont=white, singlelinecheck=false, margin=0pt, font={bf,footnotesize}}
%\DeclareCaptionFormat{table}{\colorbox[cmyk]{0.43, 0.35, 0.35,0.01}{\parbox{\textwidth}{\hspace{15pt}#1#2#3}}}
%\captionsetup[table]{format=listing,labelfont=white,textfont=white, singlelinecheck=false, margin=0pt, font={bf,footnotesize}}

% Listing environment for C
\lstnewenvironment{code}[1][]
  {\minipage{\linewidth} 
   \lstset{language=C,basicstyle=\ttfamily\footnotesize,#1}}
  {\endminipage}

% Listing environment for Assembler
\lstnewenvironment{assembler}[1][]
  {\minipage{\linewidth}
   \lstset{language=[x86masm]Assembler,basicstyle=\ttfamily\footnotesize,#1}}
  {\endminipage}

% Listing environment for bash
\lstnewenvironment{shell}[1][]
  {\minipage{\linewidth}
   \lstset{language=bash,basicstyle=\ttfamily\footnotesize,#1}}
  {\endminipage}

% Optimization environment
\newcommand{\optimization}[4]{
	\minipage{\linewidth}
	\lstinputlisting[belowskip=0.3pt,caption=#3,nolol=true,language=C,basicstyle=\tiny,label=#4]{#1}
  \hspace{\fill}\rule{0.7\linewidth}{.1pt}\hspace{\fill}
	\lstinputlisting[aboveskip=1pt,language=C,basicstyle=\small]{#2}
	\endminipage
}

% Titel and author 
\title{\includegraphics[width=1.0\textwidth]{img/fulogo}\\[1.5cm]
{\normalsize Bachelor thesis at the Computer Science Institute of the Freie Universit√§t Berlin\\ Computer Systems \& Telematics workgroup}\\[6ex] {\Huge Performance optimization of real-world algorithms on modern processor architectures\\[1cm]- DRAFT -}\\[6ex]}

\author{Malte Rohde\\
{\normalsize Immatriculation Number: 4287463 }\\
{\normalsize \mailto{malte.rohde@inf.fu-berlin.de}}\\\\
{\normalsize \textbf{Supervised by}: Prof. Dr. Marcel Kyas and Dipl.-Inform. Heiko Will}}

% Final version:
%\date{\vspace*{3.5cm} \today{}}
\date{\vspace*{1.0cm} \today{}}

\begin{document}

\begin{titlepage}

\pagenumbering{alph}
\maketitle
\thispagestyle{empty}

\vfill{}

\end{titlepage}

\pagestyle{empty}
\clearpage\pagenumbering{roman}
\include{parts/abstract}
\include{parts/declaration}

\tableofcontents
\clearpage\pagenumbering{arabic}
\pagestyle{fancy}
\setcounter{page}{1}
\input{parts/01_introduction}
\input{parts/02_related_work}
\input{parts/03_basics}
\input{parts/04_optimization}
\input{parts/05_evaluation}
\input{parts/06_conclusion}
\cleardoublepage
\phantomsection

% Bibliography
\addcontentsline{toc}{section}{References}
\bibliographystyle{alpha}
\bibliography{thesis}

\clearpage

\listoffigures
\addcontentsline{toc}{section}{Lists of Figures, Tables, and Listings}
\listoftables
\lstlistoflistings

% Appendix.
\clearpage
\begin{appendices}
\section{Three \texttt{memset} implementations}
\label{memset_code}
% TODO hide from list of listings
\lstinputlisting[nolol=true,language=C,basicstyle=\small]{code/memset.c}
\end{appendices}

\end{document}
